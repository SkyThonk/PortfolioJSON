<!--
  Testimonials Section
  - Purpose: carousel of client and colleague testimonials.
  - Includes carousel controls (prev / next), slide track and indicators.
  - Responsive: itemsPerView is updated in the component based on window width.
-->
<section id="testimonials" class="testimonials">
  <div class="container">
    <div class="section-header" appScrollAnimation animationType="fade-up">
      <h2>Testimonials</h2>
      <p>What clients and colleagues say</p>
    </div>

    <!-- Carousel wrapper: controls and track for visible testimonials -->
    <div class="testimonials-carousel">
      <button 
        class="carousel-btn prev" 
        (click)="prev()" 
        [disabled]="testimonials.length <= itemsPerView"
        aria-label="Previous testimonials">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <!-- Track wrapper: contains the list of testimonials and allows pause-on-hover -->
      <div class="testimonials-wrapper" (mouseenter)="pauseAutoScroll()" (mouseleave)="resumeAutoScroll()" (pointerdown)="pauseAutoScroll()" (pointerup)="resumeAutoScroll()">
        <div class="testimonials-track">
          @for (testimonial of getVisibleTestimonials(); track testimonial.id) {
            <div class="testimonial-card">
              <!-- Quote + body -->
              <div class="testimonial-quote">
                <span class="quote-mark">â€œ</span>
                <p class="testimonial-text">{{ testimonial.text }}</p>
              </div>

              <!-- Footer: avatar, name & meta (left), date (right) -->
              <div class="testimonial-footer">
                <div class="testimonial-meta-left">
                  <div class="testimonial-photo">
                    <img [src]="testimonial.imageUrl" [alt]="testimonial.name" />
                  </div>
                  <div class="testimonial-meta-text">
                    <h4 class="testimonial-name">{{ testimonial.name }}</h4>
                    <div class="testimonial-position">{{ testimonial.position }}</div>
                    <div class="testimonial-company">{{ testimonial.company }}</div>
                  </div>
                </div>

                <div class="testimonial-meta-right">
                  <div class="testimonial-date">{{ testimonial.date }}</div>
                  @if (testimonial.sourceUrl) {
                    <a
                      class="testimonial-source"
                      [href]="testimonial.sourceUrl"
                      target="_blank"
                      rel="noopener noreferrer"
                    >{{ testimonial.sourceText || 'Read on LinkedIn' }}</a>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </div>

      <button 
        class="carousel-btn next" 
        (click)="next()"
        [disabled]="testimonials.length <= itemsPerView"
        aria-label="Next testimonials">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <!-- Carousel indicators for navigation to specific windows of testimonials -->
    <div class="carousel-indicators">
      @for (item of testimonials; track item.id; let i = $index) {
        @if (i <= testimonials.length - itemsPerView) {
          <button 
            class="indicator" 
            [class.active]="i === currentIndex"
            (click)="currentIndex = i"
            [attr.aria-label]="'Go to testimonial ' + (i + 1)">
          </button>
        }
      }
    </div>
  </div>
</section>
